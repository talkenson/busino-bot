import { v4 } from "uuid";
import {
  createSeededRandom,
  getRandomFromArray,
  getSomeRandomFromArray,
  shuffleArray,
  uuidToFloat,
} from "../utils";

const TYPO_MAP: Record<string, string[]> = {
  Ð°: ["Ð¾", "Ñ", "Ð°Ñ…"],
  Ð±: ["Ð¿", "Ð²", "6"],
  Ð²: ["Ñ„", "Ð±", "Ñƒ"],
  Ð³: ["Ðº", "Ñ…", "Ð³Ñ‹"],
  Ð´: ["Ñ‚", "Ð»"],
  Ðµ: ["Ð¸", "Ñ", "Ñ‘", "Ð¸Ðµ"],
  Ñ‘: ["Ðµ", "Ð¾", "Ð¹Ð¾"],
  Ð¶: ["Ñˆ", "Ð·", "Ð¶Ñ‹"],
  Ð·: ["Ñ", "Ð¶"],
  Ð¸: ["Ðµ", "Ñ‹", "Ñ‹Ð¸"],
  Ð¹: ["Ð¸", "Ð¹Ð¹"],
  Ðº: ["Ð³", "Ñ…"],
  Ð»: ["Ñ€", "Ð´", "Ñƒ"],
  Ð¼: ["Ð½", "ÑÐ¼"],
  Ð½: ["Ð¼", "Ð»"],
  Ð¾: ["Ð°", "Ð¾Ñƒ"],
  Ð¿: ["Ð±", "Ñ€"],
  Ñ€: ["Ð»", "Ð´"],
  Ñ: ["Ð·", "Ñ†"],
  Ñ‚: ["Ð´", "Ñ‚ÑŒ"],
  Ñƒ: ["ÑŽ", "Ð²"],
  Ñ„: ["Ð²", "Ñ…"],
  Ñ…: ["Ð³", "Ðº", "Ñ„"],
  Ñ†: ["Ñ", "Ñ‡", "Ñ‚Ñ"],
  Ñ‡: ["Ñ‰", "Ñ†"],
  Ñˆ: ["Ð¶", "Ñ‰", "ÑˆÑ‹"],
  Ñ‰: ["Ñˆ", "Ñ‡"],
  ÑŠ: ["ÑŒ"],
  Ñ‹: ["Ð¸"],
  ÑŒ: ["ÑŠ"],
  Ñ: ["Ðµ"],
  ÑŽ: ["Ñƒ", "ÑŽÑƒ"],
  Ñ: ["Ð¹Ð°", "Ð¹Ñ"],
};

const CAPTCHA_ITEMS: [string, string[]][] = [
  [
    "ðŸŽ",
    [
      "ÑÐ±Ð»Ð¾ÐºÐ¾",
      "ÐºÑ€Ð°ÑÐ½Ñ‹Ð¹ ÐºÑ€ÑƒÐ³Ð»Ñ‹Ð¹ Ñ„Ñ€ÑƒÐºÑ‚",
      "Ñ„Ñ€ÑƒÐºÑ‚ Ñ ÑÐµÐ¼ÐµÑ‡ÐºÐ°Ð¼Ð¸",
      "ÐºÑ€ÑƒÐ³Ð»Ð¾Ðµ, Ñ€ÑƒÐ¼ÑÐ½Ð¾Ðµ, Ñ Ñ Ð´ÐµÑ€ÐµÐ²Ð° ÑƒÐ¿Ð°Ð»Ð¾",
    ],
  ],
  [
    "ðŸŒ",
    [
      "Ð±Ð°Ð½Ð°Ð½",
      "Ð´Ð»Ð¸Ð½Ð½Ñ‹Ð¹ Ð¶ÐµÐ»Ñ‚Ñ‹Ð¹ Ñ„Ñ€ÑƒÐºÑ‚",
      "Ñ„Ñ€ÑƒÐºÑ‚ Ñ Ð¿Ð°Ð»ÑŒÐ¼Ñ‹",
      "Ð¶ÐµÐ»Ñ‚Ñ‹Ð¹ Ð¿Ð¾Ð»ÑƒÐ¼ÐµÑÑÑ†, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ Ð»ÑŽÐ±ÑÑ‚ Ð¾Ð±ÐµÐ·ÑŒÑÐ½Ñ‹",
    ],
  ],
  [
    "ðŸ•",
    [
      "Ð¿Ð¸Ñ†Ñ†Ð°",
      "Ð¸Ñ‚Ð°Ð»ÑŒÑÐ½ÑÐºÐ¾Ðµ Ð±Ð»ÑŽÐ´Ð¾",
      "ÐµÐ´Ð° Ñ ÑÑ‹Ñ€Ð¾Ð¼ Ð¸ Ñ‚ÐµÑÑ‚Ð¾Ð¼",
      "ÐºÑ€ÑƒÐ³ Ñ€ÐµÐ¶ÐµÐ¼ Ð½Ð° Ñ‚Ñ€ÐµÑƒÐ³Ð¾Ð»ÑŒÐ½Ð¸ÐºÐ¸, ÐºÐ¾Ñ€Ð¾Ð±ÐºÐ° ÐºÐ²Ð°Ð´Ñ€Ð°Ñ‚Ð½Ð°Ñ",
    ],
  ],
  [
    "ðŸš—",
    [
      "Ð¼Ð°ÑˆÐ¸Ð½Ð°",
      "Ð°Ð²Ñ‚Ð¾Ð¼Ð¾Ð±Ð¸Ð»ÑŒ",
      "Ñ‚Ñ€Ð°Ð½ÑÐ¿Ð¾Ñ€Ñ‚Ð½Ð¾Ðµ ÑÑ€ÐµÐ´ÑÑ‚Ð²Ð¾",
      "Ð±Ð¸Ð±Ð¸ÐºÐ°",
      "ÑÑ‚Ð¾Ð¸Ñ‚ Ð² Ð¿Ñ€Ð¾Ð±ÐºÐ°Ñ…",
      "Ñ‡ÐµÑ‚Ñ‹Ñ€Ðµ ÐºÐ¾Ð»ÐµÑÐ°, Ñ€ÑƒÐ»ÑŒ Ð´Ð° Ð´Ð¾Ñ€Ð¾Ð³Ð°",
    ],
  ],
  [
    "ðŸ¶",
    [
      "ÑÐ¾Ð±Ð°ÐºÐ°",
      "Ñ€Ð°Ð½ÑŒÑˆÐµ Ð±Ñ‹Ð» Ð²Ð¾Ð»Ðº",
      "Ð»Ð°ÑŽÑ‰ÐµÐµ Ð¶Ð¸Ð²Ð¾Ñ‚Ð½Ð¾Ðµ",
      "Ð³Ð°Ð²ÐºÐ°ÐµÑ‚",
      "Ð»ÑƒÑ‡ÑˆÐ¸Ð¹ Ð´Ñ€ÑƒÐ³ Ñ‡ÐµÐ»Ð¾Ð²ÐµÐºÐ°",
    ],
  ],
  [
    "ðŸ±",
    [
      "ÐºÐ¾ÑˆÐºÐ°",
      "Ð¼ÑÑƒÐºÐ°ÑŽÑ‰ÐµÐµ Ð¶Ð¸Ð²Ð¾Ñ‚Ð½Ð¾Ðµ",
      "ÐºÐ¸ÑÐ°",
      "ÐºÐ¸ÑÐ¾Ð½ÑŒÐºÐ°",
      "ÑÐ°Ð¼Ð° Ð¿Ð¾ ÑÐµÐ±Ðµ Ð³ÑƒÐ»ÑÐµÑ‚, Ð¼Ñ‹ÑˆÐµÐ¹ Ð¿ÑƒÐ³Ð°ÐµÑ‚",
    ],
  ],
  [
    "ðŸŽ¸",
    [
      "Ð³Ð¸Ñ‚Ð°Ñ€Ð°",
      "Ð¼ÑƒÐ·Ñ‹ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¸Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚",
      "ÑÑ‚Ñ€ÑƒÐ½Ð½Ñ‹Ð¹ Ð¸Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚",
      "ÐµÐµÐµ Ñ€Ð¾ÐºÐºÐºÐº",
      "ÑˆÐµÑÑ‚ÑŒ ÑÑ‚Ñ€ÑƒÐ½ Ð¸ Ð·Ð²Ð¾Ð½ÐºÐ¸Ð¹ Ð³Ð¾Ð»Ð¾Ñ",
    ],
  ],
  [
    "ðŸš€",
    [
      "Ñ€Ð°ÐºÐµÑ‚Ð°",
      "ÐºÐ¾ÑÐ¼Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ ÐºÐ¾Ñ€Ð°Ð±Ð»ÑŒ",
      "Ð»ÐµÑ‚Ð°Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ð¹ Ð°Ð¿Ð¿Ð°Ñ€Ð°Ñ‚",
      "Ð»ÐµÑ‚Ð¸Ñ‚ Ðº Ð·Ð²ÐµÐ·Ð´Ð°Ð¼ Ð±Ñ‹ÑÑ‚Ñ€ÐµÐµ Ð·Ð²ÑƒÐºÐ°",
    ],
  ],
  [
    "ðŸ„",
    [
      "Ð³Ñ€Ð¸Ð±",
      "Ñ€Ð°ÑÑ‚ÐµÑ‚ Ð½Ð° Ð¼Ð¸Ñ†ÐµÐ»Ð¸Ð¸",
      "ÑÑŠÐµÐ´Ð¾Ð±Ð½Ñ‹Ð¹ Ð¸Ð»Ð¸ ÑÐ´Ð¾Ð²Ð¸Ñ‚Ñ‹Ð¹",
      "ÑÑ‚Ð¾Ð¸Ñ‚ Ð½Ð° Ð¾Ð´Ð½Ð¾Ð¹ Ð½Ð¾Ð¶ÐºÐµ Ð² Ð»ÐµÑÑƒ Ð¿Ð¾Ð´ Ð»Ð¸ÑÑ‚Ð¾Ñ‡ÐºÐ¾Ð¼",
    ],
  ],
  [
    "â˜€ï¸",
    [
      "ÑÐ¾Ð»Ð½Ñ†Ðµ",
      "Ð·Ð²ÐµÐ·Ð´Ð°",
      "Ð¸ÑÑ‚Ð¾Ñ‡Ð½Ð¸Ðº ÑÐ²ÐµÑ‚Ð° Ð¸ Ñ‚ÐµÐ¿Ð»Ð°",
      "Ð´Ð½ÐµÐ¼ ÑÐ²ÐµÑ‚Ð¸Ñ‚, Ð° Ð½Ð¾Ñ‡ÑŒÑŽ ÑÐ¿Ð°Ñ‚ÑŒ ÑƒÑ…Ð¾Ð´Ð¸Ñ‚",
    ],
  ],
  [
    "ðŸ”‘",
    [
      "ÐºÐ»ÑŽÑ‡",
      "Ð¾Ñ‚ÐºÑ€Ñ‹Ð²Ð°ÐµÑ‚ Ð·Ð°Ð¼Ð¾Ðº",
      "Ñ…Ð¾Ñ€Ð¾ÑˆÐ¾ Ð¿Ð¾Ð´Ñ…Ð¾Ð´Ð¸Ñ‚ Ð´Ð²ÐµÑ€Ð¸",
      "Ð·Ð°Ð¼Ð¾Ñ‡ÐµÐº Ð¾Ñ‚ÐºÑ€Ð¾ÐµÑ‚, Ð² ÐºÐ°Ñ€Ð¼Ð°Ð½Ðµ Ð·Ð²ÐµÐ½Ð¸Ñ‚",
    ],
  ],
  [
    "ðŸŽ",
    [
      "Ð¿Ð¾Ð´Ð°Ñ€Ð¾Ðº",
      "ÑÑŽÑ€Ð¿Ñ€Ð¸Ð·",
      "ÑƒÐ¿Ð°ÐºÐ¾Ð²Ð°Ð½Ð½Ð°Ñ Ð²ÐµÑ‰ÑŒ",
      "Ð¼Ð¾Ð¶Ð½Ð¾ Ð¿Ð¾Ð´Ð°Ñ€Ð¸Ñ‚ÑŒ",
      "Ð² ÑÑ€ÐºÐ¾Ð¹ Ð±ÑƒÐ¼Ð°Ð³Ðµ Ñ Ð¿Ñ‹ÑˆÐ½Ñ‹Ð¼ Ð±Ð°Ð½Ñ‚Ð¾Ð¼",
    ],
  ],
  [
    "ðŸŒµ",
    [
      "ÐºÐ°ÐºÑ‚ÑƒÑ",
      "ÐºÐ¾Ð»ÑŽÑ‡ÐµÐµ Ñ€Ð°ÑÑ‚ÐµÐ½Ð¸Ðµ",
      "Ñ€Ð°ÑÑ‚ÐµÐ½Ð¸Ðµ Ð¿ÑƒÑÑ‚Ñ‹Ð½Ð¸",
      "Ð¼Ð¾Ð¶ÐµÑ‚ Ð¶Ð¸Ñ‚ÑŒ Ð´Ð¾Ð»Ð³Ð¾ Ð±ÐµÐ· Ð²Ð¾Ð´Ñ‹",
      "Ð·ÐµÐ»ÐµÐ½Ñ‹Ð¹ ÐµÐ¶Ð¸Ðº Ð² ÑÐµÑ€Ð´Ñ†Ðµ Ð¿ÑƒÑÑ‚Ñ‹Ð½Ð¸",
    ],
  ],
  [
    "âš“ï¸",
    [
      "ÑÐºÐ¾Ñ€ÑŒ",
      "Ð¼Ð¾Ñ€ÑÐºÐ¾Ð¹ ÑÐ¸Ð¼Ð²Ð¾Ð»",
      "ÑƒÐ´ÐµÑ€Ð¶Ð¸Ð²Ð°ÐµÑ‚ ÐºÐ¾Ñ€Ð°Ð±Ð»ÑŒ",
      "Ð½Ð° Ð´Ð½Ð¾ Ð¿Ð°Ð´Ð°ÐµÑ‚ â€” ÐºÐ¾Ñ€Ð°Ð±Ð»ÑŒ Ð´ÐµÑ€Ð¶Ð¸Ñ‚",
    ],
  ],
  [
    "ðŸŽˆ",
    [
      "ÑˆÐ°Ñ€Ð¸Ðº",
      "Ð²Ð¾Ð·Ð´ÑƒÑˆÐ½Ñ‹Ð¹ ÑˆÐ°Ñ€",
      "Ð»ÐµÑ‚Ð°ÐµÑ‚ Ñ Ð³ÐµÐ»Ð¸ÐµÐ¼",
      "ÐºÑ€Ð°ÑÐ½Ñ‹Ð¹ Ð¸ ÐºÑ€ÑƒÐ³Ð»Ñ‹Ð¹ Ð½Ð° Ð²ÐµÑ€ÐµÐ²Ð¾Ñ‡ÐºÐµ",
      "Ð»ÐµÐ³ÐºÐ¸Ð¹, ÐºÐ°Ðº Ð²Ð¾Ð·Ð´ÑƒÑ…, Ð·Ð° Ð½Ð¸Ñ‚Ð¾Ñ‡ÐºÑƒ Ð´ÐµÑ€Ð¶Ð¸Ñ‚ÑÑ",
    ],
  ],
  [
    "ðŸ“±",
    [
      "Ñ‚ÐµÐ»ÐµÑ„Ð¾Ð½",
      "ÑÐ¼Ð°Ñ€Ñ‚Ñ„Ð¾Ð½",
      "Ð¼Ð¾Ð±Ð¸Ð»ÑŒÐ½Ð¾Ðµ ÑƒÑÑ‚Ñ€Ð¾Ð¹ÑÑ‚Ð²Ð¾",
      "Ð¼Ð¾Ð¶Ð½Ð¾ Ð¿Ð¾Ð·Ð²Ð¾Ð½Ð¸Ñ‚ÑŒ",
      "Ð½Ð¾ÐºÐ¸Ð° Ð±Ð»ÐµÐºÐ±ÐµÑ€Ñ€Ð¸ ÑÐ°Ð¼ÑÑƒÐ½Ð³ Ð°Ð¹Ñ„Ð¾Ð½ Ð²Ð¸Ð²Ð¾",
    ],
  ],
  [
    "ðŸ‘“",
    [
      "Ð¾Ñ‡ÐºÐ¸",
      "Ð¾Ð¿Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ð¿Ñ€Ð¸Ð±Ð¾Ñ€",
      "Ð´Ð»Ñ ÑƒÐ»ÑƒÑ‡ÑˆÐµÐ½Ð¸Ñ Ð·Ñ€ÐµÐ½Ð¸Ñ",
      "Ð´Ð²Ð° ÑÑ‚ÐµÐºÐ»Ð° Ð¿Ð¾ÑÐµÑ€ÐµÐ´Ð¸Ð½Ðµ Ð¿Ð°Ð»Ð¾Ñ‡ÐºÐ°",
      "Ð½Ð° Ð½Ð¾ÑÑƒ ÑÐ¸Ð´ÑÑ‚, Ð½Ð° Ð¼Ð¸Ñ€ Ð³Ð»ÑÐ´ÑÑ‚",
    ],
  ],
  [
    "ðŸ’Ž",
    [
      "Ð°Ð»Ð¼Ð°Ð·",
      "Ð±Ñ€Ð¸Ð»Ð»Ð¸Ð°Ð½Ñ‚",
      "Ð´Ñ€Ð°Ð³Ð¾Ñ†ÐµÐ½Ð½Ñ‹Ð¹ ÐºÐ°Ð¼ÐµÐ½ÑŒ",
      "Ð»ÑƒÑ‡ÑˆÐ¸Ðµ Ð´Ñ€ÑƒÐ·ÑŒÑ Ð´ÐµÐ²ÑƒÑˆÐµÐº",
      "Ñ‚Ð²ÐµÑ€Ð¶Ðµ Ð²ÑÐµÑ… Ð½Ð° ÑÐ²ÐµÑ‚Ðµ, ÑÑ€ÐºÐ¾ Ð±Ð»ÐµÑÑ‚Ð¸Ñ‚",
    ],
  ],
  [
    "ðŸ‰",
    [
      "Ð°Ñ€Ð±ÑƒÐ·",
      "Ð±Ð¾Ð»ÑŒÑˆÐ°Ñ ÑÐ³Ð¾Ð´Ð°",
      "ÑÐ»Ð°Ð´ÐºÐ¸Ð¹ Ð¸ ÑÐ¾Ñ‡Ð½Ñ‹Ð¹",
      "Ð·ÐµÐ»ÐµÐ½Ñ‹Ð¹ Ñ ÐºÑ€Ð°ÑÐ½Ð¾Ð¹ Ð¼ÑÐºÐ¾Ñ‚ÑŒÑŽ Ð¸ ÐºÐ¾ÑÑ‚Ð¾Ñ‡ÐºÐ°Ð¼Ð¸",
      "ÑÐ²ÐµÑ€Ñ…Ñƒ Ð¿Ð¾Ð»Ð¾ÑÐ°Ñ‚Ñ‹Ð¹, Ð° Ð²Ð½ÑƒÑ‚Ñ€Ð¸ ÑÐ°Ñ…Ð°Ñ€Ð½Ñ‹Ð¹",
    ],
  ],
  [
    "ðŸŒ‹",
    [
      "Ð²ÑƒÐ»ÐºÐ°Ð½",
      "Ð¾Ð³Ð½ÐµÐ´Ñ‹ÑˆÐ°Ñ‰Ð°Ñ Ð³Ð¾Ñ€Ð°",
      "Ð¸Ð·Ð²ÐµÑ€Ð³Ð°ÐµÑ‚ Ð»Ð°Ð²Ñƒ",
      "Ð³Ð¾Ñ€Ð° Ñ Ð´Ñ‹Ñ€ÐºÐ¾Ð¹",
      "Ð³Ð¾Ñ€Ð° ÑÐµÑ€Ð´Ð¸Ñ‚ÑÑ, Ð¾Ð³Ð½ÐµÐ¼ Ð¿Ð»ÑŽÐµÑ‚ÑÑ",
    ],
  ],
  [
    "ðŸ§Š",
    [
      "Ð»ÐµÐ´Ñ‹ÑˆÐºÐ°",
      "ÐºÑƒÑÐ¾Ðº Ð»ÑŒÐ´Ð°",
      "Ñ…Ð¾Ð»Ð¾Ð´Ð½Ñ‹Ð¹ Ð¸ Ð¿Ñ€Ð¾Ð·Ñ€Ð°Ñ‡Ð½Ñ‹Ð¹",
      "Ñ…Ð¾Ð»Ð¾Ð´Ð½Ñ‹Ð¹ ÐºÑƒÐ±Ð¸Ðº Ð»ÑŒÐ´Ð° ÐºÐ¸Ð½ÑŒ Ð² Ð¼ÐµÐ½Ñ",
      "Ð·Ð¸Ð¼Ð¾Ð¹ â€” Ð³Ð¾Ñ€Ð°, Ð»ÐµÑ‚Ð¾Ð¼ â€” Ð²Ð¾Ð´Ð°",
    ],
  ],
  [
    "ðŸ¦‰",
    [
      "ÑÐ¾Ð²Ð°",
      "Ð½Ð¾Ñ‡Ð½Ð°Ñ Ð¿Ñ‚Ð¸Ñ†Ð°",
      "Ð¼ÑƒÐ´Ñ€Ð°Ñ Ð¿Ñ‚Ð¸Ñ†Ð°",
      "Ñ„Ð¸Ð¾Ð»ÐµÑ‚Ð¾Ð²Ð°Ñ Ð¿Ñ‚Ð¸Ñ†Ð° Ð² ÑÐ¼ÐµÑˆÐ°Ñ€Ð¸ÐºÐ°Ñ…",
      "Ð´Ð½ÐµÐ¼ ÑÐ¿Ð¸Ñ‚, Ð½Ð¾Ñ‡ÑŒÑŽ Ð»ÐµÑ‚Ð°ÐµÑ‚, Ð³Ð»Ð°Ð·Ð°Ð¼Ð¸ ÑÐ²ÐµÑ€ÐºÐ°ÐµÑ‚",
    ],
  ],
  [
    "ðŸ¢",
    [
      "Ñ‡ÐµÑ€ÐµÐ¿Ð°Ñ…Ð°",
      "Ð¼ÐµÐ´Ð»ÐµÐ½Ð½Ð¾Ðµ Ð¶Ð¸Ð²Ð¾Ñ‚Ð½Ð¾Ðµ",
      "Ñ Ð¿Ð°Ð½Ñ†Ð¸Ñ€ÐµÐ¼",
      "Ð² Ð¼ÑƒÐ»ÑŒÑ‚Ð¸ÐºÐ°Ñ… Ð³Ð¾Ð½ÑÐµÑ‚ÑÑ Ñ Ð·Ð°Ð¹Ñ†ÐµÐ¼",
      "ÑÐ²Ð¾Ð¹ Ð´Ð¾Ð¼ Ð½Ð° ÑÐ¿Ð¸Ð½Ðµ Ð½Ð¾ÑÐ¸Ñ‚",
    ],
  ],
  [
    "ðŸ",
    [
      "Ð¿Ñ‡ÐµÐ»Ð°",
      "Ð»ÐµÑ‚Ð°ÑŽÑ‰ÐµÐµ Ð½Ð°ÑÐµÐºÐ¾Ð¼Ð¾Ðµ",
      "ÑÐ¾Ð±Ð¸Ñ€Ð°ÐµÑ‚ Ð¼ÐµÐ´",
      "Ð¶ÑƒÐ¶Ð¶Ð¸Ñ‚ Ð¸ Ð¶Ð°Ð»Ð¸Ñ‚",
      "Ð¶Ð¸Ð²ÐµÑ‚ Ð² ÑƒÐ»ÑŒÐµ",
      "Ð¿Ð¾Ð»Ð¾ÑÐ°Ñ‚Ð°Ñ Ñ‚Ñ€ÑƒÐ¶ÐµÐ½Ð¸Ñ†Ð° Ð½ÐµÐºÑ‚Ð°Ñ€ ÑÐ¾Ð±Ð¸Ñ€Ð°ÐµÑ‚",
    ],
  ],
] as const;

function corruptString(word: string, getRandom: () => number): string {
  const chars = word.split("");
  const len = chars.length;

  const replacementsCount = Math.round(len / 4);

  const targetIndices = new Set<number>();

  while (targetIndices.size < replacementsCount) {
    const randomIndex = Math.floor(getRandom() * len);
    if (targetIndices.has(randomIndex)) {
      continue;
    }
    targetIndices.add(randomIndex);
  }

  return chars
    .map((char, index) =>
      targetIndices.has(index) && char in TYPO_MAP
        ? getRandomFromArray(TYPO_MAP[char], getRandom)
        : char,
    )
    .join("");
}

export const createCaptcha = (uuid: string = v4(), count = 6) => {
  const key = uuidToFloat(uuid);
  const randomizer = createSeededRandom(key);
  const items = getSomeRandomFromArray(CAPTCHA_ITEMS, count, randomizer);
  const targetId = key % count;
  const targetItem = items[targetId];
  const textsLen = targetItem[1].length;
  const targetText = targetItem[1][key % textsLen];

  return {
    pattern: corruptString(targetText, randomizer),
    targetId: targetId,
    items: shuffleArray(
      items.map(([emoji], id) => ({ text: emoji, data: id })),
      Math.random,
    ),
  };
};

if (import.meta.main) {
  CAPTCHA_ITEMS.forEach(([emoji, words]) => {
    console.log(`${emoji}`);
    words.forEach((word) => {
      console.log(`${word} -> ${corruptString(word, Math.random)}`);
    });
  });
}
